<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>HfTL-Club - Infoscreen</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="../common/css/bootstrap.min.css">
    <link rel="stylesheet" href="../common/css/bootstrap.cyborg.min.css">
    <link rel="stylesheet" href="../common/css/style.css">



    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script type="text/javascript" src="../common/js/jquery-1.8.2.min.js"></script>
    <script type="text/javascript" src="../common/js/jquery.slimscroll.min.js"></script>
    <script type="text/javascript" src="../common/js/jquery.kinetic.min.js"></script>
    <script type="text/javascript" src="../common/js/bootstrap.min.js"></script>

</head>
<body>
    <div class="container">
        <!-- Getränkekarten View -->
        <div class="row">
            <div class="page-header">
                <h1>HfTL-Club <small><span class="glyphicon glyphicon-glass"></span> Getränkekarte</small></h1>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <div class="panel panel-default panel-pizza">
                    <div class="panel-heading">Biers</div>
                    <div class="panel-body">
                        <table class="table table-striped">
                            <tr>
                                <th>Getränk</th>
                                <th>Preis</th>
                            </tr>
                            <tr>
                                <td>Uri</td>
                                <td>1,00 €</td>
                            </tr>
                            <tr>
                                <td>Paulaner Heefeweizen (dunkel)</td>
                                <td>1,50 €</td>
                            </tr>
                        </table>
                    </div>
                    <div class="panel-footer">Footer für Zusatzstoffe</div>
                </div>
            </div>
            <div class="col-12">
                <div class="panel panel-default panel-pizza">
                    <div class="panel-heading">Cocktails</div>
                    <div class="panel-body">
                        
                    </div>
                </div>
            </div>
        </div>

        <!-- Freitext View -->
        <div class="row">
            <div class="page-header">
                <h1>HfTL-Club <small><span class="glyphicon glyphicon-info-sign"></span> Informationen</small></h1>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <div class="panel panel-default panel-pizza">
                    <div class="panel-heading">Auswahl</div>
                    <div class="list-group" id="pizza-selection">
                    </div>
                </div>
            </div>
            <div class="col-12">
                <div class="panel panel-default panel-pizza">
                    <div class="panel-heading">Bestellung</div>
                    <div class="panel-body">
                        <form role="form" id="cart-form">
                            <div class="form-group">
                                <label for="input-cart-name">Name</label>
                                <input id="input-cart-name" class="form-control" placeholder="Namen eingeben" onfocus="jsKeyboard.focus(this);clean(this);placeholder=''" ontouchstart="jsKeyboard.focus(this);clean(this);placeholder=''">
                            </div>
                            <div class="form-group">
                                <label>Ausgewählt</label>
                                <div class="list-group" id="cart-items">
                                </div>
                            </div>
                            <input type="submit" class="btn btn-success btn-lg btn-block" value="Jetzt zahlungspflichtig bestellen">
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script type="text/javascript">

        $(function orderLogic() {
            var dataUrl = "json.php?mode=all_pizzas&service=platzhalter";
            var orderUrl = "post_order.php";
            var orders = [];

            $.ajax({
                type: "get",
                url: dataUrl,
                dataType: "json",
                success: processData,
                error: function (o, c, m) { alert(m); }
            });

            $('#order-modal').modal({ show: false });
            $('#order-modal-form').submit(addOrderSubmit);
            $('#cart-form').submit(submitOrder);

            function processData(data) {
                var $list = $("#pizza-selection");

                $.each(data, function (i, item) {
                    var $num = $("<span>");
                    $num.addClass("label label-primary");
                    $num.css("width", '35px');
                    $num.css("display", 'inline-block');
                    $num.text(item["number"]);

                    var $name = $("<h4>");
                    $name.addClass("list-group-item-heading");
                    $name.append($num);
                    $name.append(" ");
                    $name.append(item.name);

                    var $ingredients = $("<p>");
                    $ingredients.addClass("list-group-item-text");
                    $ingredients.css("margin-left", "40px");
                    $ingredients.text(item.ingredients.join(", "));

                    var $entry = $("<a>");
                    $entry.addClass("list-group-item");
                    $entry.attr("href", "#");
                    $entry.append($name);
                    $entry.append($ingredients);

                    $list.append($entry);

                    $entry.click(function () {
                        addOrderDialog(item);
                    });

                });

            };

            function addOrderDialog(item) {
                var $num = $("<span>");
                $num.addClass("label");
                $num.addClass("label-primary");
                $num.text(item["number"]);

                var $name = $("<span>");
                $name.text("Pizza " + item.name);

                $('#order-modal-name').empty();
                $('#order-modal-name').append($num)
                $('#order-modal-name').append(' ')
                $('#order-modal-name').append($name);

                $('#order-modal-ingredients').text(item.ingredients.join(", "));

                $('#order-modal').modal('show');
                $('#order-modal-comment').val("");

                $('#order-modal-form').data('item', item);

            };

            function addOrderSubmit() {
                var item = $('#order-modal-form').data('item');
                var comment = $('#order-modal-comment').val();

                $('#order-modal').modal('hide');

                addToCart(item, comment);

                return false;

            };

            function addToCart(item, comment) {
                orders.push({ id: item.id, comment: comment });

                var $entry = $("<a>");
                $entry.addClass("list-group-item");
                $entry.text(item.name);

                if (comment) {
                    var $asterisk = $("<span>");
                    $asterisk.addClass("text-danger");
                    $asterisk.text('*');
                    $entry.append(" ");
                    $entry.append($asterisk);

                }

                $("#cart-items").append($entry);

            };

            function submitOrder() {
                var data = {};
                data.pizzas = orders;
                data.name = $('#input-cart-name').val();

                $.ajax({
                    type: "post",
                    url: orderUrl,
                    data: JSON.stringify(data),
                    contentType: "application/json",
                    success: function () { alert("Bitte geh zur Bar bezahlen.") },
                    error: function (o, c, m) { alert(m); },
                });

                return false;

            };

        });

    </script>
</body>
</html>
