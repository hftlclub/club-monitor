<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>HfTL-Club - Infoscreen</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="../common/css/bootstrap.min.css">
    <link rel="stylesheet" href="../common/css/bootstrap.cyborg.min.css">
    <link rel="stylesheet" href="../common/css/style.css">

    <style type="text/css">

		@media (min-width: 1900px) {
			body {
				font-size: 300%;
				overflow: hidden;
			}

			h1 {
				font-size: 60px;
			}

			#drinks-notes p {
				font-size: 17pt;
			}

			.large-text {
				font-size: 30pt;
			}
		}
    </style>


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script type="text/javascript" src="../common/js/jquery-1.8.2.min.js"></script>
    <script type="text/javascript" src="../common/js/jquery.slimscroll.min.js"></script>
    <script type="text/javascript" src="../common/js/jquery.kinetic.min.js"></script>
    <script type="text/javascript" src="../common/js/bootstrap.min.js"></script>

</head>
<body>
    <div class="container-fluid">
    <div id="stecker"></div>

        <div id="modules">
            <div data-module="drinks">
                <!-- Getränkekarten View -->
                <div class="row">
                    <div class="col-md-12">
						<div class="page-header steckerlogo">
							<h1>HfTL-Club <small><span class="glyphicon glyphicon-glass"></span> Getränkekarte</small></h1>
						</div>
                    </div>
                </div>

                <div class="row" id="catlist"></div>


				<div id="drinks-notes">
					<p>
						Für unsere Gläser erheben wir 1 € Pfand, für Weizengläser sind es 2 €.<br>
							Zusatzstoffe: <span id="additives"></span>
					</p>
                </div>
            </div>

            <div data-module="text">
                <!-- Freitext View -->
                <div class="row">
                    <div class="col-md-12">
						<div class="page-header steckerlogo">
							<h1>HfTL-Club <small><span class="glyphicon glyphicon-info-sign"></span> Informationen</small></h1>
						</div>
					</div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="well">
                        	<h1 data-bind="headline">Hello, world!</h1>
                       		<p data-bind="body">This is a simple hero unit, a simple jumbotron-style component for calling extra attention to featured content or information...</p>
                        </div>
                    </div>
                </div>
            </div>


            <div data-module="highlights">
                <!-- Image/Next Highlights View -->
                <div class="row">
                    <div class="col-md-12">
						<div class="page-header steckerlogo">
							<h1>HfTL-Club <small><span class="glyphicon glyphicon-star"></span> Highlights</small></h1>
						</div>
					</div>
                </div>
                <div class="row">
                    <div class="col-md-6" id="hightlights-picture-row">
                        <div style="text-align:center;">
                            <img data-bind="picture" src="" height="" />
                        </div>
                    </div>
					<div class="col-md-6" id="highlights-description-row">
						<p data-bind="description" class="large-text">This is a simple hero
						unit, a simple jumbotron-style component for
						calling extra attention to featured content or
						information...</p>
					</div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        // JS Block for module handling
        var activeTimelineModule = null;

        $(function moduleLogic() {
            //first: hide all modules:
            hideAllModules();

            //second: load timeline from database...
            var dataUrl = "json.php?mode=timeline";

            $.ajax({
                type: "get",
                url: dataUrl,
                dataType: "json",
                success: processTimelineData,
                error: function (o, c, m) { alert(m); }
            });

            function processTimelineData(data)
            {
				function next() {
					var frame = data.shift();

					if(!frame) {
						// reload page
						window.location.href = window.location.href;
						return;
					}

					switchToModule(frame.type);

					switch(frame.type) {
						case 'drinks':
							// nuttin' to do
							break;
						case 'text':
							getBindElement('text', 'headline').text(frame.settings.headline);
							getBindElement('text', 'body').html(frame.settings.body);
							break;
						case 'highlights':
							getBindElement('highlights', 'description').html(frame.settings.description);
							getBindElement('highlights', 'picture')
								.attr('src', '')
								.attr('src', frame.settings.url)
								.attr('height', windowHeight()-160);

							if(frame.settings.description) {
								$("#hightlights-picture-row")
									.removeClass("col-md-12")
									.addClass("col-md-6");
								$("#highlights-description-row").show();
								var descHeight = $("#highlights-description-row").height();
								var boxHeight = windowHeight()-160;
								var margin = (boxHeight - descHeight) / 2;
								$("#highlights-description-row")
									.css("margin-top", margin+"px")
									.css("padding-right", "40px");

							} else {
								$("#hightlights-picture-row")
									.removeClass("col-md-6")
									.addClass("col-md-12");
								$("#highlights-description-row").hide();
							}

							break;
					};


					window.setTimeout(next, frame.duration * 1000);
				}

				next();

            }

            //DEBUG: start with drinks:
            //switchToModule("drinks");

        });

		function getBindElement(module, name) {
			return $('[data-module="'+module+'"] [data-bind="'+name+'"]');
		}

        function switchToModule(moduleName)
        {
            hideAllModules();
            $('[data-module="'+moduleName+'"]').show();
        }

		function hideAllModules() {
			$('[data-module]').hide()
		};
    </script>


    <script type="text/javascript">
        // JS Block für Gertänkekarte-logik
        $(function orderLogic() {
            var dataUrl = "json.php?mode=drinks";

            $.ajax({
                type: "get",
                url: dataUrl,
                dataType: "json",
                success: processData,
                error: function (o, c, m) { alert(m); }
            });


            function processData(data) {
                //the view container
                var $catlist = $("#catlist");

				var cols = {
					'left': {
						'size' : 0,
						'$el' : $('<div>').addClass('col-md-6'),
					},
					'right': {
						'size' : 0,
						'$el' : $('<div>').addClass('col-md-6'),
					},
				};

				$catlist.append(cols.left.$el);
				$catlist.append(cols.right.$el);

				data.categories.sort(function(a, b){
					if( a.drinks.length > b.drinks.length )
						return -1;

					if( a.drinks.length < b.drinks.length )
						return 1;

					return 0;

				});

				console.log(data.categories);

				//go through categories
                $.each(data.categories, function (i, cat) {
                    //initialize table
                    var $table = $("<table>")
                    	.addClass("table");

					var groups = {};

                    //go through drinks and make table
                    $.each(cat.drinks, function (i, drink) {

						var $label = $("<span>").text(drink.name);
						if(drink.additives != null)
							$label.after($("<sup>").text(drink.additives.join(", ")));

						if(groups[drink.group]) {
							groups[drink.group].append(" / ").append($label);
						}
						else {
							var $td = $("<td>").append($label);
							var $tr = $("<tr>")
								.append(
									$td
								).append(
									$("<td style='width:20%; text-align:right;'>").text(drink.size)
								)
								.append(
									$("<td style='width:20%; text-align:right;'>").text(parsePrice(drink.price))
								);

							$table.append($tr);
							if(drink.group)
								groups[drink.group] = $td;
						}

                    });


					if(cols.right.size >= cols.left.size)
						var col = cols.left;
					else
						var col = cols.right;

					col.size = col.size + cat.drinks.length;
                    //build the category box
                    col.$el.append(
									$("<div>")
										.addClass("panel panel-default panel-pizza")
										.append(
											$("<div>")
												.addClass("panel-heading")
												.text(cat.name)
										)
										.append($table)
                    );


                    //build additives list for footer
                    var $add_text = "";

                    var len = data.additives.length;
                    $.each(data.additives, function (i, item) {
                    	$add_text += item.index + " - " + item.name;
                    	if(i < len - 1) {
                    		$add_text += ", ";
                    	}
                    });

                    $("#additives").text($add_text);

                });

				if(cols.right.size >= cols.left.size)
					cols.left.$el.append($('#drinks-notes'));
				else
					cols.right.$el.append($('#drinks-notes'));

            }


            //parse float value to price string: 1.5 to 1,50 EUR
            function parsePrice(price){
				retval = parseFloat(price, 10).toFixed(2).toString()
				retval = retval.replace(".", ",");
				retval += " EUR";

				return retval;
            }



		});

	function windowHeight () {
 		 if (window.innerHeight) {
 		   	return window.innerHeight;
		  } else if (document.body && document.body.offsetHeight) {
		  	  return document.body.offsetHeight;
		  } else {
		    return 0;
		  }

		}
    </script>

</body>
</html>
