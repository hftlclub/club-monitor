<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>HfTL-Club - Pizzabestellung</title>

    <!-- Bootstrap -->
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
	<link rel="stylesheet" href="../common/css/bootstrap.cyborg.min.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

	<style type="text/css">
	</style>

  </head>
  <body>

	<div class="container">
		<div class="row">
			<div class="page-header">
				<h1>HfTL-Club <small>Pizzabestellung</small></h1>
			</div>
		</div>

		<div class="row">
			<div class="col-sm-6">
				<div class="panel panel-default panel-pizza">
                    <div class="panel-heading">Auswahl</div>
					<div class="list-group" id="pizza-selection">
					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="panel panel-default panel-pizza">
					<div class="panel-heading">Bestellung</div>
					<div class="panel-body">
						<form role="form" id="cart-form">
							<div class="form-group">
								<label for="input-cart-name">Name</label>
								<input id="input-cart-name" class="form-control" placeholder="Namen eingeben">
							</div>
							<div class="form-group">
								<label>Ausgewählt</label>
								<div class="list-group" id="cart-items">
								</div>
							</div>
							<input type="submit" class="btn btn-success btn-lg btn-block" value="Jetzt zahlungspflichtig bestellen">
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Order Modal -->
	<div class="modal fade" id="order-modal" tabindex="-1" role="dialog" aria-labelledby="order-modal-label" aria-hidden="true">
		<div class="modal-dialog">
			<form role="form" id="order-modal-form">
				<div class="modal-content">
					<div class="modal-body">
						<h3 id="order-modal-name" style="margin-top: 0;"></h3>
						<div class="form-group">
							<p id="order-modal-ingredients"></p>
						</div>
						<div class="form-group" style="margin-top: 25px;">
							<label class="control-label">Zusätzliche Angaben</label>
							<textarea id="order-modal-comment" class="form-control"></textarea>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Abbrechen</button>
						<input type="submit" class="btn btn-success" value="Hinzufügen">
					</div>
				</div>
			</form>
		</div>
	</div>


    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
	<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

	<script src="../common/js/jquery.slimscroll.min.js"></script>

	<script type="application/javascript">
		$(function fancyScroll() {
			$('.panel-pizza > .list-group').slimScroll({
		        height: '250px'
		    });
		});

		$(function orderLogic(){
			var dataUrl = "json.php?mode=all_pizzas&service=platzhalter";
			var orderUrl = "post_order.php";
			var orders = [];
			
			$.ajax({
				type: "get",
				url: dataUrl,
                dataType: "json",
				success: processData,
                error: function(o,c,m) { alert(m); }
			});

			$('#order-modal').modal({ show: false });
			$('#order-modal-form').submit(addOrderSubmit);
			$('#cart-form').submit(submitOrder);

			function processData(data) {
				var $list = $("#pizza-selection");

				$.each(data, function(i, item){
					var $num = $("<span>");
					$num.addClass("badge");
					$num.text(item["number"]);

					var $name = $("<h4>");
					$name.addClass("list-group-item-heading");
					$name.text(item.name);

					var $ingredients = $("<p>");
					$ingredients.addClass("list-group-item-text");
					$ingredients.text(item.ingredients.join(", "));

					var $entry = $("<a>");
					$entry.addClass("list-group-item");
					$entry.attr("href", "#");
					$entry.append($num);
					$entry.append($name);
					$entry.append($ingredients);

					$list.append($entry);

					$entry.click(function(){
						addOrderDialog(item);
					});

				});

			};

			function addOrderDialog(item) {
				$('#order-modal-name').text("Pizza " + item.name);
				$('#order-modal-ingredients').text(item.ingredients.join(", "));

				$('#order-modal').modal('show');
				$('#order-modal-comment').val("");

				$('#order-modal-form').data('item', item);

			};

			function addOrderSubmit() {
				var item = $('#order-modal-form').data('item');
				var comment = $('#order-modal-comment').val();

				$('#order-modal').modal('hide');

				addToCart(item, comment);

				return false;

			};

			function addToCart(item, comment) {
				orders.push({id: item.id, comment: comment});

				var $entry = $("<a>");
				$entry.addClass("list-group-item");
				$entry.text(item.name);

				if(comment) {
					var $asterisk = $("<span>");
					$asterisk.addClass("text-danger");
					$asterisk.text('*');
					$entry.append(" ");
					$entry.append($asterisk);

				}

				$("#cart-items").append($entry);

			};

			function submitOrder() {
				var data = {};
				data.pizzas = orders;
				data.name = $('#input-cart-name').val();

				$.ajax({
					type: "post",
					url: orderUrl,
					data: JSON.stringify(data),
					contentType: "application/json",
					success: function(){alert("yep")},
					error: function(o,c,m) { alert(m); },
				});

				return false;

			};

		});

        $("#input-cart-name").focusout(function() {
            jsKeyboard.hide();
        })

	</script>

</html>
