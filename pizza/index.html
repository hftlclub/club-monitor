<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap 101 Template</title>

    <!-- Bootstrap -->
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
	<link rel="stylesheet" href="/common/css/bootstrap.cyborg.min.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

	<style type="text/css">
		.panel-pizza {
			position: relative;
		}

		.panel-pizza > .list-group, .panel-pizza > .panel-body {
			height: 600px;
			overflow: auto;
		}
	</style>

  </head>
  <body>

	<div class="container">
		<div class="row">
			<div class="page-header">
				<h1>HfTL-Club <small>Pizzabestellung</small></h1>
			</div>
		</div>

		<div class="row">
			<div class="col-sm-6">
				<div class="panel panel-default panel-pizza">
                    <div class="panel-heading">Auswahl</div>
					<div class="list-group" id="pizza-selection">
					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="panel panel-default panel-pizza">
					<div class="panel-heading">Bestellung</div>
					<div class="panel-body">
						<form role="form" id="order">
							<div class="form-group">
								<label for="input-name">Name</label>
								<input id="input-name" class="form-control" placeholder="Namen eingeben">
							</div>
							<div class="form-group">
								<label>Ausgewählt</label>
								<div class="list-group">
									<a href="#" class="list-group-item">Cras justo odio</a>
									<a href="#" class="list-group-item">Dapibus ac facilisis in</a>
									<a href="#" class="list-group-item">Morbi leo risus <span class="badge">14</span></a>
									<a href="#" class="list-group-item">Porta ac consectetur ac <span class="text-danger">*</span></a>
									<a href="#" class="list-group-item">Vestibulum at eros</a>
								</div>
							</div>
							<input type="submit" class="btn btn-success btn-lg btn-block" value="Jetzt zahlungspflichtig bestellen">
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Order Modal -->
	<div class="modal fade" id="order-modal" tabindex="-1" role="dialog" aria-labelledby="order-modal-label" aria-hidden="true">
		<div class="modal-dialog">
			<form role="form" id="order-modal-form">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						<h4 class="modal-title" id="order-modal-label">Pizza bestellen</h4>
					</div>
					<div class="modal-body">
						<div class="form-group">
							<label class="control-label">Pizza</label>
							<p id="order-modal-name"></p>
						</div>
						<div class="form-group">
							<label class="control-label">Zutaten</label>
							<p id="order-modal-ingredients"></p>
						</div>
						<div class="form-group">
							<label class="control-label">Kommentar</label>
							<textarea id="order-modal-comment" class="form-control"></textarea>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Abbrechen</button>
						<input type="submit" class="btn btn-success" value="Hinzufügen">
					</div>
				</div>
			</form>
		</div>
	</div>


    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
	<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

	<script type="application/javascript">
		$(function postOrder(){
			var url = "post_order.php";

			return false;

		});

		$(function loadData(){
			var url = "json.php?mode=all_pizzas&service=platzhalter";
			
			$.ajax({
				type: "get",
				url: url,
				success: processData,
			});

			$('#order-modal').modal({ show: false });
			$('#order-modal-form').submit(addOrderSubmit);

			function processData(data) {
				var $list = $("#pizza-selection");

				$.each(data, function(i, item){
					var $num = $("<span>");
					$num.addClass("badge");
					$num.text(item["number"]);

					var $name = $("<h4>");
					$name.addClass("list-group-item-heading");
					$name.text(item.name);

					var $ingredients = $("<p>");
					$ingredients.addClass("list-group-item-text");
					$ingredients.text(item.ingredients.join(", "));

					var $entry = $("<a>");
					$entry.addClass("list-group-item");
					$entry.attr("href", "#");
					$entry.append($num);
					$entry.append($name);
					$entry.append($ingredients);

					$list.append($entry);

					$entry.click(function(){
						addOrderDialog(item);
					});

				});

			};

			function addOrderDialog(item) {
				$('#order-modal-name').text(item.name);
				$('#order-modal-ingredients').text(item.ingredients.join(", "));

				$('#order-modal').modal('show');
				$('#order-modal-comment').val("");

				$('#order-modal-form').data('item', item);


			};

			function addOrderSubmit() {
				console.log($('#order-modal-form').data('item'));

			};

		});

	</script>

</html>
